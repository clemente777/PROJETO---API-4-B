<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Pizzaria dos Manos</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-gradient-to-b from-orange-50 to-orange-100 text-gray-800">

  <!-- Cabe√ßalho -->
  <header class="bg-gradient-to-r from-orange-500 to-red-500 py-12 text-center text-white shadow-xl">
    <h1 class="text-4xl font-bold">Pizzaria dos Manos</h1>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-10">

    <!-- Mensagens -->
    <div id="loading" class="hidden mb-4 font-semibold text-red-500">
      Carregando pizzas...
    </div>

    <div id="erro" class="hidden mb-4 rounded-xl bg-red-100 p-4 text-red-600"></div>
    <div id="sucesso" class="hidden mb-4 rounded-xl bg-green-100 p-4 text-green-600"></div>

    <!-- Formul√°rio -->
    <form id="form"
      class="mb-10 grid grid-cols-1 gap-4 rounded-2xl bg-white p-8 shadow-lg sm:grid-cols-2 lg:grid-cols-3">

      <input type="hidden" id="id">

      <input id="nome" placeholder="Nome da pizza"
        class="rounded-xl border p-3 focus:outline-none focus:ring-2 focus:ring-orange-400">

      <input id="valor" type="number" placeholder="Valor"
        class="rounded-xl border p-3 focus:outline-none focus:ring-2 focus:ring-orange-400">

      <input id="descricao" placeholder="Descri√ß√£o"
        class="rounded-xl border p-3 focus:outline-none focus:ring-2 focus:ring-orange-400">

      <select id="status"
        class="rounded-xl border p-3 focus:outline-none focus:ring-2 focus:ring-orange-400">
        <option value="disponivel">Dispon√≠vel</option>
        <option value="indisponivel">Indispon√≠vel</option>
        <option value="promocao">Promo√ß√£o</option>
      </select>

      <select id="tipo"
        class="rounded-xl border p-3 focus:outline-none focus:ring-2 focus:ring-orange-400">
        <option value="tradicional">Tradicional</option>
        <option value="doce">Doce</option>
        <option value="vegana">Vegana</option>
        <option value="vegetariana">Vegetariana</option>
        <option value="especial">Especial</option>
        <option value="gourmet">Gourmet</option>
        
      </select>

      <button type="submit"
        class="rounded-xl bg-orange-500 py-4 font-semibold text-white transition hover:bg-orange-600 sm:col-span-2 lg:col-span-3">
        Salvar
      </button>
    </form>

    <!-- Filtros -->
    <div class="mb-8 flex flex-wrap gap-4">
      <select id="filtroStatus" onchange="listar()"
        class="rounded-xl border p-3 focus:outline-none focus:ring-2 focus:ring-orange-400">
        <option value="">Todos os status</option>
        <option value="disponivel">Dispon√≠vel</option>
        <option value="indisponivel">Indispon√≠vel</option>
        <option value="promocao">Promo√ß√£o</option>
      </select>

      <select id="filtroTipo" onchange="listar()"
        class="rounded-xl border p-3 focus:outline-none focus:ring-2 focus:ring-orange-400">
        <option value="">Todos os tipos</option>
        <option value="tradicional">Tradicional</option>
        <option value="doce">Doce</option>
        <option value="vegana">Vegana</option>
        <option value="vegetariana">Vegetariana</option>
        <option value="especial">Especial</option>
        <option value="gourmet">Gourmet</option>
      </select>
    </div>

    <!-- Lista -->
    <div id="lista" class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3"></div>

  </main>

<script>
const API = "http://localhost:5000/pizzas";

/* Elementos */
const loading = document.getElementById("loading");
const lista = document.getElementById("lista");
const form = document.getElementById("form");

const idInput = document.getElementById("id");
const nomeInput = document.getElementById("nome");
const valorInput = document.getElementById("valor");
const descInput = document.getElementById("descricao");
const statusInput = document.getElementById("status");
const tipoInput = document.getElementById("tipo");

const filtroStatus = document.getElementById("filtroStatus");
const filtroTipo = document.getElementById("filtroTipo");
const erro = document.getElementById("erro");
const sucesso = document.getElementById("sucesso");

/* Mensagens */
function mostrar(elemento, mensagem) {
  elemento.textContent = mensagem;
  elemento.classList.remove("hidden");
}

function esconderMensagens() {
  erro.classList.add("hidden");
  sucesso.classList.add("hidden");
}

/* Listar pizzas */
async function listar() {
  esconderMensagens();
  loading.classList.remove("hidden");
  lista.innerHTML = "";

  try {
    const res = await fetch(API);
    let pizzas = await res.json();

    if (filtroStatus.value)
      pizzas = pizzas.filter(p => p.status === filtroStatus.value);
    if (filtroTipo.value)
      pizzas = pizzas.filter(p => p.tipo === filtroTipo.value);

    pizzas.forEach(p => {
      lista.innerHTML += `
      <div class="rounded-2xl bg-white p-6 shadow-lg">
        <h3 class="text-xl font-bold text-red-500">${p.nome}</h3>
        <p class="mt-2 text-gray-600">${p.descricao}</p>
        <p class="mt-2">üí∞ R$ ${p.valor}</p>
        <p class="text-sm text-gray-500">Tipo: ${p.tipo}</p>
        <p class="text-sm text-gray-500">Status: ${p.status}</p>

        <div class="mt-4 flex flex-col gap-2">
          <button onclick="editar(${p.id})"
            class="rounded-lg bg-orange-400 py-2 text-white hover:bg-orange-500">
            Editar
          </button>

          <button onclick="remover(${p.id})"
            class="rounded-lg bg-red-500 py-2 text-white hover:bg-red-600">
            Remover
          </button>

          <button onclick="mudarStatus(${p.id})"
            class="rounded-lg bg-yellow-400 py-2 hover:bg-yellow-500">
            Mudar status
          </button>
        </div>
      </div>`;
    });

  } catch {
    mostrar(erro, "Erro ao carregar a API");
  } finally {
    loading.classList.add("hidden");
  }
}

/* Salvar / editar */
form.onsubmit = async e => {
  e.preventDefault();
  esconderMensagens();

  const pizza = {
    nome: nomeInput.value.trim(),
    descricao: descInput.value.trim(),
    valor: Number(valorInput.value),
    status: statusInput.value,
    tipo: tipoInput.value
  };

  if (pizza.nome.length < 3)
    return mostrar(erro, "Nome deve ter no m√≠nimo 3 caracteres");
  if (pizza.valor <= 0)
    return mostrar(erro, "Valor deve ser maior que zero");

  const statusValidos = ["disponivel", "indisponivel", "promocao"];
  if (!statusValidos.includes(pizza.status))
    return mostrar(erro, "Selecione um status v√°lido");

  const tiposValidos = ["tradicional","doce","vegana","vegetariana","especial","gourmet"];
  if (!tiposValidos.includes(pizza.tipo))
    return mostrar(erro, "Selecione um tipo de pizza v√°lido");

  try {
    const res = await fetch(
      idInput.value ? `${API}/${idInput.value}` : API,
      {
        method: idInput.value ? "PUT" : "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(pizza)
      }
    );

    if (!res.ok) throw new Error();

    mostrar(sucesso, "üçï Pizza salva com sucesso!");
    form.reset();
    idInput.value = "";

    setTimeout(listar, 1500);

  } catch {
    mostrar(erro, "Erro ao salvar pizza");
  }
};

/* Editar */
async function editar(id) {
  const res = await fetch(API);
  const pizzas = await res.json();
  const p = pizzas.find(p => p.id === id);

  idInput.value = p.id;
  nomeInput.value = p.nome;
  valorInput.value = p.valor;
  descInput.value = p.descricao;
  statusInput.value = p.status;
  tipoInput.value = p.tipo;
}

/* Remover */
async function remover(id) {
  if (!confirm("Deseja remover esta pizza?")) return;

  esconderMensagens();

  try {
    const res = await fetch(`${API}/${id}`, { method: "DELETE" });
    if (!res.ok) throw new Error();

    mostrar(sucesso, "üóëÔ∏è Pizza removida com sucesso!");
    setTimeout(listar, 1500);

  } catch {
    mostrar(erro, "Erro ao remover pizza");
  }
}

/* Mudar status */
async function mudarStatus(id) {
  const res = await fetch(API);
  const pizzas = await res.json();
  const p = pizzas.find(p => p.id === id);

  const novo =
    p.status === "disponivel" ? "promocao" :
    p.status === "promocao" ? "indisponivel" : "disponivel";

  await fetch(`${API}/${id}/status`, {
    method: "PATCH",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ status: novo })
  });

  listar();
}

listar();
</script>

</body>
</html>
