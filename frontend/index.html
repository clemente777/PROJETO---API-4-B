<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Pizzaria dos Manos</title>

<style>
:root{
    --primary:#ff6b35;
    --primary-dark:#e63946;
    --card:#ffffff;
    --text:#2b2b2b;
    --success:#22c55e;
    --warning:#f59e0b;
    --danger:#ef4444;
    --shadow:0 14px 35px rgba(0,0,0,.12);
}

*{ box-sizing:border-box; }

body{
    margin:0;
    font-family: system-ui, Arial;
    background:linear-gradient(180deg,#fff7f3,#fff0e8);
    color:var(--text);
}

header{
    background:linear-gradient(135deg,var(--primary),var(--primary-dark));
    padding:50px;
    text-align:center;
    color:white;
}

.container{
    width:90%;
    max-width:1100px;
    margin:40px auto;
}

.loading{
    display:none;
    font-weight:600;
    margin-bottom:15px;
    color:var(--primary-dark);
}

.erro{
    display:none;
    background:#ffe4e6;
    color:var(--danger);
    padding:14px;
    border-radius:14px;
    margin-bottom:15px;
}

.sucesso{
    display:none;
    background:#dcfce7;
    color:var(--success);
    padding:14px;
    border-radius:14px;
    margin-bottom:15px;
}

form{
    background:var(--card);
    padding:30px;
    border-radius:22px;
    box-shadow:var(--shadow);
    margin-bottom:40px;
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:18px;
}

form input, form select{
    padding:14px;
    border-radius:14px;
    border:1px solid #e5e7eb;
}

form button{
    grid-column:1/-1;
    padding:16px;
    border-radius:16px;
    background:var(--primary);
    color:white;
    border:none;
    font-size:1.1rem;
}

.filtros{
    display:flex;
    gap:16px;
    margin-bottom:30px;
    flex-wrap:wrap;
}

.filtros select{
    padding:14px;
    border-radius:14px;
    border:1px solid #e5e7eb;
}

#lista{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
    gap:24px;
}

.card{
    background:var(--card);
    padding:24px;
    border-radius:24px;
    box-shadow:var(--shadow);
}

.card h3{ color:var(--primary-dark); margin:0; }

.card button{
    margin-top:12px;
    padding:12px;
    border-radius:14px;
    border:none;
    cursor:pointer;
    color:white;
}

.card button:nth-of-type(1){ background:#fb923c; }
.card button:nth-of-type(2){ background:var(--danger); }
.card button:nth-of-type(3){ background:var(--warning); color:#000; }
</style>
</head>

<body>

<header>
    <h1>Pizzaria dos Manos</h1>
</header>

<div class="container">

<div id="loading" class="loading">Carregando pizzas...</div>
<div id="erro" class="erro"></div>
<div id="sucesso" class="sucesso"></div>

<form id="form">
    <input type="hidden" id="id">
    <input id="nome" placeholder="Nome da pizza">
    <input id="valor" type="number" placeholder="Valor">
    <input id="descricao" placeholder="Descri√ß√£o">

    <select id="status">
        <option value="disponivel">Dispon√≠vel</option>
        <option value="indisponivel">Indispon√≠vel</option>
        <option value="promocao">Promo√ß√£o</option>
    </select>

    <select id="tipo">
        <option value="tradicional">Tradicional</option>
        <option value="doce">Doce</option>
        <option value="vegana">Vegana</option>
        <option value="vegetariana">Vegetariana</option>
        <option value="especial">Especial</option>
        <option value="gourmet">Gourmet</option>
    </select>

    <button type="submit">Salvar</button>
</form>

<div class="filtros">
    <select id="filtroStatus" onchange="listar()">
        <option value="">Todos os status</option>
        <option value="disponivel">Dispon√≠vel</option>
        <option value="indisponivel">Indispon√≠vel</option>
        <option value="promocao">Promo√ß√£o</option>
    </select>

    <select id="filtroTipo" onchange="listar()">
        <option value="">Todos os tipos</option>
        <option value="tradicional">Tradicional</option>
        <option value="doce">Doce</option>
        <option value="vegana">Vegana</option>
        <option value="vegetariana">Vegetariana</option>
        <option value="especial">Especial</option>
        <option value="gourmet">Gourmet</option>
    </select>
</div>

<div id="lista"></div>
</div>

<script>
const API = "http://localhost:5000/pizzas";

const erro = document.getElementById("erro");
const sucesso = document.getElementById("sucesso");
const loading = document.getElementById("loading");
const lista = document.getElementById("lista");

const idInput = document.getElementById("id");
const nomeInput = document.getElementById("nome");
const valorInput = document.getElementById("valor");
const descInput = document.getElementById("descricao");
const statusInput = document.getElementById("status");
const tipoInput = document.getElementById("tipo");

const filtroStatus = document.getElementById("filtroStatus");
const filtroTipo = document.getElementById("filtroTipo");

function limparMensagens(){
    erro.style.display = "none";
    sucesso.style.display = "none";
}

async function listar(){
    limparMensagens();
    loading.style.display = "block";
    lista.innerHTML = "";

    try{
        const res = await fetch(API);
        if(!res.ok) throw new Error();
        let pizzas = await res.json();

        if (filtroStatus.value)
            pizzas = pizzas.filter(p => p.status === filtroStatus.value);
        if (filtroTipo.value)
            pizzas = pizzas.filter(p => p.tipo === filtroTipo.value);

        pizzas.forEach(p => {
            lista.innerHTML += `
            <div class="card">
                <h3>${p.nome}</h3>
                <p>${p.descricao}</p>
                <p>üí∞ R$ ${p.valor}</p>
                <p>Tipo: ${p.tipo}</p>
                <p>Status: ${p.status}</p>
                <button onclick="editar(${p.id})">Editar</button>
                <button onclick="remover(${p.id})">Remover</button>
                <button onclick="mudarStatus(${p.id})">Mudar status</button>
            </div>`;
        });
    }catch{
        erro.style.display = "block";
        erro.innerText = "Erro ao carregar a API";
    }finally{
        loading.style.display = "none";
    }
}

form.onsubmit = async e => {
    e.preventDefault();
    limparMensagens();

    const pizza = {
        nome: nomeInput.value.trim(),
        descricao: descInput.value.trim(),
        valor: Number(valorInput.value),
        status: statusInput.value,
        tipo: tipoInput.value
    };

    if (pizza.nome.length < 3)
        return erroMsg("Nome deve ter no m√≠nimo 3 caracteres");
    if (!pizza.descricao)
        return erroMsg("Descri√ß√£o √© obrigat√≥ria");
    if (pizza.valor <= 0)
        return erroMsg("Valor deve ser maior que zero");

    try{
        const res = await fetch(idInput.value ? `${API}/${idInput.value}` : API,{
            method: idInput.value ? "PUT" : "POST",
            headers:{ "Content-Type":"application/json" },
            body: JSON.stringify(pizza)
        });

        const data = await res.json();
        if(!res.ok) return erroMsg(data.erro);

        sucesso.style.display = "block";
    sucesso.innerText = "Pizza salva com sucesso!";

    form.reset();
    idInput.value = "";

    setTimeout(() => {
        listar();
}, 1500);

    }catch{
        erroMsg("Erro ao conectar com a API");
    }
};

function erroMsg(msg){
    erro.style.display = "block";
    erro.innerText = msg;
}

async function editar(id){
    const res = await fetch(API);
    const pizzas = await res.json();
    const p = pizzas.find(p => p.id === id);
    idInput.value = p.id;
    nomeInput.value = p.nome;
    valorInput.value = p.valor;
    descInput.value = p.descricao;
    statusInput.value = p.status;
    tipoInput.value = p.tipo;
}


async function remover(id){
    if (!confirm("Deseja remover?")) return;

    erro.style.display = "none";
    sucesso.style.display = "none";

    try{
        const res = await fetch(`${API}/${id}`, { method: "DELETE" });
        const data = await res.json();

        if (!res.ok) {
            erro.style.display = "block";
            erro.innerText = data.erro || "Erro ao remover pizza";
            return;
        }

        sucesso.style.display = "block";
        sucesso.innerText = " Pizza removida com sucesso!";

        setTimeout(() => {
            listar();
        }, 1500);

    } catch {
        erro.style.display = "block";
        erro.innerText = "Erro ao conectar com a API";
    }
}


async function mudarStatus(id){
    const res = await fetch(API);
    const pizzas = await res.json();
    const p = pizzas.find(p => p.id === id);

    const novoStatus =
        p.status === "disponivel" ? "promocao" :
        p.status === "promocao" ? "indisponivel" : "disponivel";

    await fetch(`${API}/${id}/status`,{
        method:"PATCH",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ status: novoStatus })
    });

    listar();
}

listar();
</script>

</body>
</html>
