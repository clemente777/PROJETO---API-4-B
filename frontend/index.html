<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Pizzaria dos manos</title>
<style>
:root {
    --vermelho: #c0392b;
    --verde: #27ae60;
    --verde-hover: #219150;
    --azul: #2980b9;
    --cinza-bg: #f4f6f8;
    --cinza-texto: #555;
}

* {
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: var(--cinza-bg);
    margin: 0;
    color: var(--cinza-texto);
}

/* HEADER */
header {
    background: linear-gradient(135deg, #c0392b, #e74c3c);
    color: white;
    padding: 25px;
    text-align: center;
    box-shadow: 0 3px 10px rgba(0,0,0,0.15);
}

header h1 {
    margin: 0;
    font-size: 2rem;
}

/* CONTAINER */
.container {
    width: 90%;
    max-width: 1000px;
    margin: 25px auto;
}

/* FORM */
form {
    background: white;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 25px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

form input,
form select {
    width: 100%;
    padding: 10px;
    margin: 8px 0;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 0.95rem;
}

form input:focus,
form select:focus {
    outline: none;
    border-color: var(--vermelho);
}

form button {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: bold;
}

/* BOT√ïES */
button {
    background: var(--verde);
    color: white;
    border: none;
    cursor: pointer;
    transition: 0.2s ease;
}

button:hover {
    background: var(--verde-hover);
    transform: scale(1.02);
}

/* FEEDBACK */
.loading {
    color: var(--azul);
    font-weight: bold;
    margin-bottom: 10px;
}

.erro {
    color: #e74c3c;
    margin: 10px 0;
    font-weight: bold;
}

.sucesso {
    color: var(--verde);
    margin: 10px 0;
    font-weight: bold;
}

/* FILTROS */
.filtros {
    margin-bottom: 20px;
}

.filtros select {
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
}

/* CARDS */
.card {
    background: white;
    border-radius: 10px;
    padding: 18px;
    margin-bottom: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    transition: 0.2s ease;
}

.card:hover {
    transform: translateY(-3px);
}

.card h3 {
    margin: 0 0 8px 0;
    color: var(--vermelho);
}

.card p {
    margin: 4px 0;
}

/* BOT√ïES DO CARD */
.card button {
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 0.85rem;
    margin-right: 5px;
    margin-top: 8px;
}

.card button:nth-child(1) {
    background: #3498db;
}

.card button:nth-child(1):hover {
    background: #2980b9;
}

.card button:nth-child(2) {
    background: #e74c3c;
}

.card button:nth-child(2):hover {
    background: #c0392b;
}

.card button:nth-child(3) {
    background: #f39c12;
}

.card button:nth-child(3):hover {
    background: #d68910;
}

/* RESPONSIVO */
@media (max-width: 600px) {
    header h1 {
        font-size: 1.6rem;
    }

    .card button {
        width: 100%;
        margin-right: 0;
    }
}
</style>

</head>

<body>

<header>
    <h1>Pizzaria dos Manos</h1>
</header>

<div class="container">

    <!-- FEEDBACK -->
    <div class="loading" id="loading" style="display:none">Carregando...</div>
    <div class="erro" id="erro"></div>
    <div class="sucesso" id="sucesso"></div>

    <!-- FORMUL√ÅRIO -->
    <form id="form">
        <input type="hidden" id="id">

        <input type="text" id="nome" placeholder="Nome da pizza" required>
        <input type="number" id="valor" placeholder="Valor (R$)" required>
        <input type="text" id="descricao" placeholder="Descri√ß√£o" required>

        <select id="status">
            <option value="disponivel">Dispon√≠vel</option>
            <option value="indisponivel">Indispon√≠vel</option>
            <option value="promocao">Promo√ß√£o</option>
        </select>

        <button type="submit">Salvar</button>
    </form>

    <!-- FILTROS -->
    <div class="filtros">
        <select id="filtroStatus" onchange="listar()">
            <option value="">Todos os status</option>
            <option value="disponivel">Dispon√≠vel</option>
            <option value="indisponivel">Indispon√≠vel</option>
            <option value="promocao">Promo√ß√£o</option>
        </select>
    </div>

    <!-- LISTA -->
    <div id="lista"></div>

</div>

<script>
const API = "http://localhost:5000/pizzas";

const loading = document.getElementById("loading");
const erro = document.getElementById("erro");
const sucesso = document.getElementById("sucesso");
const lista = document.getElementById("lista");

const form = document.getElementById("form");
const idInput = document.getElementById("id");
const nomeInput = document.getElementById("nome");
const valorInput = document.getElementById("valor");
const descInput = document.getElementById("descricao");
const statusInput = document.getElementById("status");
const filtroStatus = document.getElementById("filtroStatus");

// LISTAR PIZZAS
async function listar() {
    loading.style.display = "block";
    erro.innerText = "";
    lista.innerHTML = "";

    try {
        const res = await fetch(API);
        if (!res.ok) throw new Error();

        let dados = await res.json();

        // filtro por status
        if (filtroStatus.value) {
            dados = dados.filter(p => p.status === filtroStatus.value);
        }

        dados.forEach(p => {
            lista.innerHTML += `
            <div class="card">
                <h3>${p.nome}</h3>
                <p>${p.descricao}</p>
                <p>üí∞ R$ ${p.valor}</p>
                <p>Status: ${p.status}</p>

                <button onclick="editar(${p.id})">Editar</button>
                <button onclick="remover(${p.id})">Remover</button>
                <button onclick="mudarStatus(${p.id})">Mudar status</button>
            </div>`;
        });

    } catch {
        erro.innerText = "Erro ao carregar dados da API.";
    }

    loading.style.display = "none";
}

// SALVAR (POST / PUT)
form.onsubmit = async e => {
    e.preventDefault();
    erro.innerText = "";
    sucesso.innerText = "";

    const pizza = {
        nome: nomeInput.value,
        valor: Number(valorInput.value),
        descricao: descInput.value,
        status: statusInput.value
    };

    const id = idInput.value;
    const metodo = id ? "PUT" : "POST";
    const url = id ? `${API}/${id}` : API;

    try {
        const res = await fetch(url, {
            method: metodo,
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(pizza)
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data.erro);

        sucesso.innerText = " Item salvo com sucesso!";
        form.reset();
        idInput.value = "";
        listar();

    } catch (e) {
        erro.innerText = "erro " + e.message;
    }
};

// EDITAR
async function editar(id) {
    const res = await fetch(API);
    const pizzas = await res.json();
    const p = pizzas.find(p => p.id === id);

    idInput.value = p.id;
    nomeInput.value = p.nome;
    valorInput.value = p.valor;
    descInput.value = p.descricao;
    statusInput.value = p.status;
}

// REMOVER
async function remover(id) {
    if (!confirm("Deseja remover?")) return;

    try {
        const res = await fetch(`${API}/${id}`, { method: "DELETE" });
        if (!res.ok) throw new Error();

        sucesso.innerText = " Pizza removida!";
        listar();

    } catch {
        erro.innerText = " Erro ao remover pizza.";
    }
}

async function mudarStatus(id) {
    erro.innerText = "";
    sucesso.innerText = "";

    try {
        const res = await fetch(API);
        const pizzas = await res.json();
        const p = pizzas.find(p => p.id === id);

        const novoStatus =
            p.status === "disponivel" ? "indisponivel" : "disponivel";

        const resp = await fetch(`${API}/${id}/status`, {
            method: "PATCH",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ status: novoStatus })
        });

        const data = await resp.json();
        if (!resp.ok) throw new Error(data.erro);

        sucesso.innerText = " Status atualizado!";
        listar();

    } catch (e) {
        erro.innerText = " Erro ao alterar status.";
    }
}



// INICIAL
listar();
</script>

</body>
</html>
